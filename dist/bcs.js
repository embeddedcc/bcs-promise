/*! bcs-promises - v0.1.4 - 2015-09-25 */var BCS={version:"0.1.4"};BCS.Helpers=function(){var Helpers=function(device){this.device=device};return Helpers.prototype.getProbes=function(){for(var promises=[],i=0;i<this.device.probeCount;i++)promises.push(this.device.read("temp/"+i));return Q.all(promises)},Helpers.prototype.getTempValues=function(){return this.device.read("temp").then(function(response){return Q.all(response.map(function(temp){return temp/10}))})},Helpers.prototype.getDins=function(){for(var promises=[],i=0;i<this.device.inputCount;i++)promises.push(this.device.read("din/"+i));return Q.all(promises)},Helpers.prototype.getDinValues=function(){return this.device.read("din")},Helpers.prototype.getOutputs=function(){for(var promises=[],i=0;i<this.device.outputCount;i++)promises.push(this.device.read("output/"+i));return Q.all(promises)},Helpers.prototype.getOutputValues=function(){return this.device.read("output")},Helpers.prototype.getTimerValues=function(process){return this.device.read("process/"+process+"/timer").then(function(response){return Q.all(response.map(function(timer){return new BCS.Time(timer.value)}))})},Helpers.prototype.getTimerStrings=function(process){return this.getTimerValues(process).then(function(timers){return Q.all(timers.map(function(timer){return timer.toString()}))})},Helpers.prototype.getRunningProcesses=function(){return this.device.read("poll").then(function(poll){return Q.all(poll.process.map(function(p,i){return p.id=i,p}).filter(function(p){return p.running}))})},Helpers.prototype.getProcesses=function(){for(var promises=[],i=0;8>i;i++)promises.push(this.device.read("process/"+i));return Q.all(promises)},Helpers}(),BCS.Device=function(){var Device=function(address,options){var parsedAuth,obj=this;return this.address=address,this.ready=!1,this.type=null,this.version=null,this.helpers=new BCS.Helpers(this),this.url=(this.address.match(/^http/)?"":"http://")+this.address+(this.address.match(/\/$/)?"":"/")+"api/",this._callbacks={},this.options=options||{},!this.options.auth&&this.url.match(/http:\/\/(.+):(.+)@/)&&(parsedAuth=this.url.match(/http:\/\/(.+):(.+)@/).slice(1),this.options.auth={username:parsedAuth[0],password:parsedAuth[1]},this.url=this.url.replace(/(http:\/\/)(.+:.+@)/,"$1")),this.options.auth?this.request=request.defaults({auth:this.options.auth}):this.request=request,this.read("device").then(function(body){obj.ready=!0,obj.version=body.version,obj.type=body.type,obj.trigger("ready")})["catch"](function(error){obj.trigger("notReady",[error])}),this};return Device.prototype={get probeCount(){return this.ready?"BCS-460"===this.type?4:8:null},get inputCount(){return this.ready?"BCS-460"===this.type?4:8:null},get outputCount(){return this.ready?"BCS-460"===this.type?6:18:null}},Device.prototype.on=function(event,callback){return void 0===this._callbacks[event]?this._callbacks[event]=[callback]:this._callbacks[event].push(callback),this},Device.prototype.trigger=function(event,arg){var obj=this;void 0!==this._callbacks[event]&&this._callbacks[event].forEach(function(callback){callback.apply(obj,arg)})},Device.prototype.read=function(resource){var deferred=Q.defer();return this.request({url:this.url+resource,json:!0},function(e,_,body){return e?void deferred.reject(e):void deferred.resolve(body)}),deferred.promise},Device.prototype.write=function(resource,data){var deferred=Q.defer();return this.request({url:this.url+resource,json:data,method:"POST"},function(e,xhr,body){return e&&202!==xhr.statusCode?void deferred.reject(e):void deferred.resolve(body)}),deferred.promise},Device}(),BCS.Time=function(){var Time=function(time){return this.value=time/10||0,this},formatNumber=function(n){return 10>n?"0"+n:""+n};return Time.prototype.toString=function(){var hours=Math.floor(this.value/3600),minutes=Math.floor(this.value%3600/60),seconds=Math.floor(this.value%60);return hours+":"+formatNumber(minutes)+":"+formatNumber(seconds)},Time.fromString=function(s){for(var parts=s.split(":").reverse(),value=0,i=0;i<parts.length;i++){if(i>2)return new Time(value);value+=parseInt(parts[i])*Math.pow(60,i)}return new Time(10*value)},Time}();